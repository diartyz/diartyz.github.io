# ES2018

---

## å¼‚æ­¥è¿­ä»£å™¨

```javascript
interface AsyncIterable {
  [Symbol.asyncIterator]() : AsyncIterator
}

interface AsyncIterator {
  next() : Promise<IteratorResult>
}

interface IteratorResult {
  value: any
  done: boolean
}
```

- for await of

```javascript
async function f() {
  for await (const x of createAsyncIterable(['a', 'b'])) {
    console.log(x)
  }
}
```

---

## å¯¹è±¡å±•å¼€è¿ç®—ç¬¦

```javascript
const obj = {foo: 1, bar: 2, baz: 3}
const {foo, ...rest} = obj
// Same as:
// const foo = 1
// const rest = {bar: 2, baz: 3}

function func({param1, param2, ...rest}) { // rest operator
  console.log('All parameters: ', {param1, param2, ...rest}) // spread operator
  return param1 + param2
}
```

---

## æ­£åˆ™è¡¨è¾¾å¼å‘½åæ•è·ç»„

```javascript
const RE_DATE = /(?<year>[0-9]{4})-(?<month>[0-9]{2})-(?<day>[0-9]{2})/

const matchObj = RE_DATE.exec('1999-12-31')
const year = matchObj.groups.year // 1999
const month = matchObj.groups.month // 12
const day = matchObj.groups.day // 31

const year2 = matchObj[1] // 1999
const month2 = matchObj[2] // 12
const day2 = matchObj[3] // 31

const {groups: {day, year}} = RE_DATE.exec('1999-12-31')
console.log(year) // 1999
console.log(day) // 31
```

- replace()

```javascript
const RE_DATE = /(?<year>[0-9]{4})-(?<month>[0-9]{2})-(?<day>[0-9]{2})/
console.log('1999-12-31'.replace(RE_DATE, '$<month>/$<day>/$<year>'))
// 12/31/1999

const RE_DATE = /(?<year>[0-9]{4})-(?<month>[0-9]{2})-(?<day>[0-9]{2})/
console.log('1999-12-31'.replace(
  RE_DATE,
  (g0,y,m,d,offset,input, {year, month, day}) => month+'/'+day+'/'+year,
))
// 12/31/1999

console.log('1999-12-31'.replace(RE_DATE,
  (...args) => {
    const {year, month, day} = args[args.length-1]
    return month+'/'+day+'/'+year
  }
))
// 12/31/1999
```

- æœªåŒ¹é…

```javascript
const RE_OPT_A = /^(?<as>a+)?$/
const matchObj = RE_OPT_A.exec('')

// We have a match:
console.log(matchObj[0] === '') // true

// Group <as> didnâ€™t match anything:
console.log(matchObj.groups.as === undefined) // true

// But property `as` exists:
console.log('as' in matchObj.groups) // true
```

---

## æ­£åˆ™è¡¨è¾¾å¼ Unicode è½¬ä¹‰

- \p{prop=value}
- \P{prop=value}
- \p{bin_prop}
- \P{bin_prop}

```javascript
// åŒ¹é…ç©ºæ ¼
/^\p{White_Space}+$/u.test('\t \n\r')
// true

// åŒ¹é…å­—æ¯
/^\p{Letter}+$/u.test('Ï€Ã¼Ã©')
// true

// åŒ¹é…å¸Œè…Šå­—æ¯
/^\p{Script=Greek}+$/u.test('Î¼ÎµÏ„Î¬')
// true

// åŒ¹é…æ‹‰ä¸å­—æ¯
/^\p{Script=Latin}+$/u.test('GrÃ¼ÃŸe')
// true
/^\p{Script=Latin}+$/u.test('faÃ§on')
// true
/^\p{Script=Latin}+$/u.test('maÃ±ana')
// true

// åŒ¹é… lone surrogate characters
/^\p{Surrogate}+$/u.test('\u{D83D}')
true
/^\p{Surrogate}+$/u.test('\u{DE00}')
true

// åŒ¹é… emoji
> /^\p{Surrogate}+$/u.test('ğŸ˜€')
false
> /^.$/u.test('ğŸ˜€')
true
> /^ğŸ˜€$/u.test('ğŸ˜€')
true
```

---

## æ­£åˆ™è¡¨è¾¾å¼åå‘æ–­è¨€

- `(?=pattern)`
- `(?!pattern)`
- `(?<=pattern)`
- `(?<!pattern)`

```javascript
// æ­£å‘æ–­è¨€
const RE_AS_BS = /aa(?=bb)/

const match1 = RE_AS_BS.exec('aabb')
console.log(match1[0]) // 'aa'

const match2 = RE_AS_BS.exec('aab')
console.log(match2) // null

const RE_AS_NO_BS = /aa(?!bb)/
RE_AS_NO_BS.test('aabb')
// false
RE_AS_NO_BS.test('aab')
// true
RE_AS_NO_BS.test('aac')
true

// åå‘æ–­è¨€
const RE_DOLLAR_PREFIX = /(?<=\$)foo/g
'$foo %foo foo'.replace(RE_DOLLAR_PREFIX, 'bar')
// '$bar %foo foo'

const RE_DOLLAR_PREFIX = /(\$)foo/g
'$foo %foo foo'.replace(RE_DOLLAR_PREFIX, '$1bar')
// '$bar %foo foo'

'a1ba2ba3b'.match(/(?<=b)a.b/g)
// [ 'a2b', 'a3b' ]

const RE_NO_DOLLAR_PREFIX = /(?<!\$)foo/g
'$foo %foo foo'.replace(RE_NO_DOLLAR_PREFIX, 'bar')
// '$foo %bar bar'
```

---

## æ­£åˆ™è¡¨è¾¾å¼ s (dotAll) flag

```javascript
/^.$/.test('\n')
// false

/^.$/s.test('\n')
// true

/^.$/.test('ğŸ˜€')
// false

/^.$/u.test('ğŸ˜€')
// true

// [^] (â€œall characters except no characterâ€)
// [\s\S] (â€œeither whitespace nor not whitespaceâ€).
/^[^]$/.test('\n')
// true
/^[\s\S]$/.test('\n')
// true
```

---

## Promise.prototype.finally()

---

## éè½¬ä¹‰æ¨¡æ¿å­—ç¬¦ä¸²

```javascript
`\u{4B}`
// 'K'
String.raw`\u{4B}`
// '\\u{4B}'

function tagFunc(tmplObj, substs) {
  return {
    Cooked: tmplObj,
    Raw: tmplObj.raw,
  }
}
```
