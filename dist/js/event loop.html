<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Bree+Serif"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/solarized-light.min.css"><link rel="stylesheet" href="../../static/main.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><title>event loop</title></head><body><h1 id="-">事件循环</h1><h2 id="-">浏览器</h2><ul><li>task：script 中代码、setTimeout、setInterval、I/O、UI render</li><li>microtask: promise、Object.observe、MutationObserver</li></ul><hr><ul><li>执行完主执行线程中的任务</li><li>取出 Microtask Queue 中任务执行直到清空</li><li>取出 Macrotask Queue 中一个任务执行</li><li>取出 Microtask Queue 中任务执行直到清空</li><li>重复 3 和 4</li></ul><h2 id="node">node</h2><ul><li>timers：执行满足条件的 setTimeout、setInterval 回调</li><li>I/O callbacks：是否有已完成的 I/O 操作的回调函数，来自上一轮的 poll 残留</li><li>idle，prepare：仅内部使用，可忽略</li><li>poll：等待还没完成的 I/O 事件，会因 timers 和超时时间等结束等待</li><li>check：执行 setImmediate 的回调</li><li>close callbacks：关闭所有的 closing handles，一些 onclose 事件</li></ul><hr><ul><li>同步任务</li><li>发出异步请求</li><li>规划定时器生效的时间</li><li>执行 <code>process.nextTick()</code></li><li>清空当前循环内的 Timers Queue，清空 NextTick Queue，清空 Microtask Queue</li><li>清空当前循环内的 I/O Queue，清空 NextTick Queue，清空 Microtask Queue</li><li>清空当前循环内的 Check Queu，清空 NextTick Queue，清空 Microtask Queue</li><li>清空当前循环内的 Close Queu，清空 NextTick Queue，清空 Microtask Queue</li><li>进入下轮循环</li></ul></body></html>